import{B as ae,r as n,o as B,C as m,E as V,h as U,_ as le,l as E,b as y,c as h,d as r,t as C,K as ne,w as x,x as ie,H,F as D,i as T,G as F,m as N,p as ce,e as de}from"./index-58a73ee5.js";import{u as O}from"./modal-07ceaae3.js";import{l as ue}from"./locates-b3be1fc3.js";const M=O(),pe=ae("property",()=>{const s=n([]),d=n([]),u=n([]),p=n(0),_=n([]),P=n(!1),g=n(""),a=n([]),v=n(""),b=n([]),S=n([]),k=n(""),f=n(1),t=n(12);B(async()=>{P.value=!0;const{data:o}=await m.listProperty();s.value=o,d.value=o,p.value=d.value.length,P.value=!1});function i(){s.value.forEach(o=>{_.value.push(o)})}V(()=>s.value,()=>{_.value=[],i()},{deep:!0});const l=o=>{console.log("id ",o),g.value=o,u.value=[],M.handleClickModalProperty(!1)},Z=async o=>{try{const e=await m.createProperty(o);e.status===201?s.value.push(e.data):console.error("Error al agregar el predio: ",e.statusText)}catch(e){console.error("Error al comunicarse con el servidor: ",e)}},j=o=>{console.log("id",o),v.value=o,M.handleClickModalAssignUserSpecies()},A=async o=>{try{const e=await m.createUsersProperty(o);e.status===201?a.value.push(e.data):console.error("Error al agregar el predio: ",e.statusText)}catch(e){console.error("Error al comunicarse con el servidor: ",e)}},z=async o=>{try{const e=await m.listPropertyId(o);b.value=e.data}catch(e){console.error("Error al comunicarse con el servidor: ",e)}},$=async o=>{try{s.value=o}catch(e){console.log(e)}},L=U(()=>Math.ceil(s.value.length/t.value)),G=U(()=>{const o=(f.value-1)*t.value,e=o+t.value;return s.value.slice(o,e)});function K(o){o>=1&&o<=L.value&&(f.value=o)}function R(){d.value&&(s.value=d.value)}function q(o){s.value=d.value.filter(e=>{const c=o.toLowerCase(),I=e.nombre_predio?e.nombre_predio.toLowerCase():"",ee=e.expediente?e.expediente.toLowerCase():"",oe=e.nom_comunes?e.nom_comunes.toLowerCase():"",te=e.first_name?e.first_name.toLowerCase():"",re=e.last_name?e.last_name.toLowerCase():"",se=e.nombre_cientifico_especie?e.nombre_cientifico_especie.toLowerCase():"";return I.includes(c)||ee.includes(c)||oe.includes(c)||te.includes(c)||re.includes(c)||se.includes(c)})}async function J(o){try{const e=await m.listUserSpeciesId(o);console.log("data user species: ",e),e.status===200?(S.value=e.data,M.handleClickModalListUserSpecies()):console.error("Error al listar las especies: ",e.statusText)}catch(e){console.error("Error al comunicarse con el servidor: ",e)}}function Q(o){k.value=o,u.value=d.value.filter(e=>e.id===o),M.handleClickModalProperty(!0)}const W=async(o,e)=>{const c=s.value.findIndex(I=>I.id===o);c!==-1?(Object.assign(s.value[c],e),await m.updateProperty(o,e)):console.error(`Predio con ID ${o} no encontrado.`)};async function X(o){const e=s.value.findIndex(c=>c.id===o);return e===-1?{message:"Especie no encontrada"}:(s.value.splice(e,1),await m.deleteUsersProperty(o),{message:"Especie eliminada"})}async function Y(o){const e=s.value.findIndex(c=>c.id===o);return e===-1?{message:"Predio no encontrado"}:(s.value.splice(e,1),await m.deleteProperty(o),{message:"Predio eliminado con éxito"})}return{createProperty:Z,listProperty:$,property:s,propertyOriginal:d,deleteProperty:Y,searchTerm:q,removeFilterProperty:R,changePage:K,displayedProperty:G,datosImport:_,cargando:P,totalProperty:p,userSelected:g,selectedUserCreateProperty:l,createUsersProperty:A,propertyUsers:a,selectedUserCreateUsersProperty:j,userPropertySelected:v,listPropertyId:z,propertyUser:b,listUserSpeciesIds:J,userSpecies:S,deleteSpecieUser:X,selectedPropertyUpdate:Q,updateProperty:W,propertySelected:u,currentPage:f,itemsPerPage:t,totalPages:L}});const w=s=>(ce("data-v-08ba8851"),s=s(),de(),s),_e={key:0,class:"modal"},me={class:"modal__contenido"},ve={class:"form__modal--content"},fe={class:"form__modal--title"},ye=w(()=>r("hr",null,null,-1)),he=["onSubmit"],we={class:"form__modal--field"},Pe=w(()=>r("label",{class:"form__modal--label"},"Nombre del predio: ",-1)),ge={class:"form__modal--field"},be=w(()=>r("label",{class:"form__modal--label",for:"departamento"},"Departamento:",-1)),Se=w(()=>r("option",{value:""},"--Seleccione--",-1)),Ce=["value"],xe={class:"form__modal--field"},Me={class:"form__modal--label",for:"municipio"},Ue=w(()=>r("option",{value:""},"-- Seleccione--",-1)),ke=["value"],Ie={key:0,class:"msg__error"},Ee={class:"form__modal--buttons"},Ve={type:"submit",class:"form__modal--save"},Le={style:{width:"2rem"},xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor"},He=w(()=>r("path",{d:"M7 19V13H17V19H19V7.82843L16.1716 5H5V19H7ZM4 3H17L21 7V20C21 20.5523 20.5523 21 20 21H4C3.44772 21 3 20.5523 3 20V4C3 3.44772 3.44772 3 4 3ZM9 15V19H15V15H9Z"},null,-1)),De=[He],Te=w(()=>r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-6 h-6"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m9.75 9.75 4.5 4.5m0-4.5-4.5 4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})],-1)),Fe=[Te],Ne={__name:"ModalProperty",setup(s){const d=ue(),u=pe(),p=O(),_=n(""),P=U(()=>p.isEdit),g=()=>{const t=u.propertySelected[0];t?a.value={nombre_predio:t.nombre_predio||"",p_departamento:t.p_departamento||"",p_municipio:t.p_municipio||""}:v()},a=n({p_user:"",nombre_predio:"",p_departamento:"",p_municipio:""});V(()=>u.userSelected,t=>{a.value.p_user=t});function v(){a.value.nombre_predio="",a.value.p_departamento="",a.value.p_municipio=""}const b=()=>{try{u.createProperty(a.value),v(),p.handleClickModalProperty(!1)}catch(t){t.response&&t.response.data&&t.response.data.error?alert(t.response.data.error):alert("Ocurrió un error al procesar la solicitud.")}};async function S(){await u.updateProperty(u.propertySelected[0].id,a.value),v(),p.handleClickModalProperty(!1)}V(()=>u.propertySelected,(t,i)=>{t!==i&&g()},{immediate:!0});const k=()=>{if(console.log("datos user: ",a.value),Object.values(a.value).some(t=>t==="")){_.value="Hay campos vacíos",setTimeout(()=>{_.value=""},3e3);return}P.value?S():b()},f=U(()=>{const{p_departamento:t}=a.value;return t?d.cities.filter(l=>l.department===t):[]});return B(()=>{g()}),(t,i)=>E(p).modalProperty?(y(),h("div",_e,[r("div",me,[r("div",ve,[r("h3",fe,C(P.value?"Actualizar predio":"Registrar nuevo predio"),1),ye,r("form",{class:"form__modal",onSubmit:ne(k,["prevent"])},[r("div",we,[Pe,x(r("input",{class:"form__modal--input",type:"text","onUpdate:modelValue":i[0]||(i[0]=l=>a.value.nombre_predio=l)},null,512),[[ie,a.value.nombre_predio]])]),r("div",ge,[be,x(r("select",{id:"departamento",class:"form__modal--input","onUpdate:modelValue":i[1]||(i[1]=l=>a.value.p_departamento=l)},[Se,(y(!0),h(D,null,T(E(d).departments,l=>(y(),h("option",{key:l.id,value:l.code},C(l.name),9,Ce))),128))],512),[[H,a.value.p_departamento]])]),r("div",xe,[x(r("label",Me,"Ciudad:",512),[[F,f.value.length]]),x(r("select",{id:"municipio",class:"form__modal--input","onUpdate:modelValue":i[2]||(i[2]=l=>a.value.p_municipio=l)},[Ue,(y(!0),h(D,null,T(f.value,l=>(y(),h("option",{key:l.id,value:l.id},C(l.name),9,ke))),128))],512),[[H,a.value.p_municipio],[F,f.value.length]])]),_.value?(y(),h("p",Ie,C(_.value),1)):N("",!0),r("div",Ee,[r("button",Ve,[(y(),h("svg",Le,De))]),r("div",{class:"button__modal--close",onClick:i[3]||(i[3]=l=>(E(p).handleClickModalProperty(!1),v()))},Fe)])],40,he)])])])):N("",!0)}},je=le(Ne,[["__scopeId","data-v-08ba8851"]]);export{je as M,pe as p};

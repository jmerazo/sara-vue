import{C as A,v as m,w as R,U as Y,r as B,o as u,c as p,a as e,j as r,d as i,t as l,k as j,F as $,s as ee,A as q,_ as oe,u as te,h as se,x as N,y as D,i as L,b as V,p as ae,e as ne}from"./index-fa7bc976.js";import{a as ce,P as O,f as S,F as I,M as re,T as ie,O as le,V as de,I as _e,t as ue,b as pe,S as E,c as K,d as U,e as z}from"./icon_tree_cg-e7704d93.js";const me={key:0,class:"contenedor"},fe={class:"map__datos"},ve={class:"dato"},ge={class:"map__datos"},he={class:"dato"},we={class:"map__datos"},ye={class:"dato"},be={class:"map__datos"},Pe={class:"dato"},Ce={class:"map__datos"},Ve={class:"dato"},Se={class:"map__datos"},$e={class:"dato"},Me={class:"map__datos"},ke={class:"dato"},xe={class:"map__datos"},Fe={class:"dato"},Ge={class:"map__datos"},Ne={class:"dato"},De={class:"map__datos"},Le={class:"dato"},Ie={__name:"RenderGeoMap",setup(f,{expose:v}){const c=A(),w=m(null),d=m(null),n=m(null);let t=null;const _=new ce({features:[]});function M(){_.clear();const s=c.coordinatesPolygon;y(s)}v({onlyPerimeter:M});function y(s){if(s&&s.length>0){const a=s.map(x=>S(x)),o=new K([a]),g=new I({geometry:o});g.setStyle(new E({stroke:new U({color:"green",width:2}),fill:new z({color:"rgba(0, 255, 0, 0.1)"})})),_.addFeature(g)}}R(()=>{P()}),Y(()=>c.geoDataNew,()=>{b(),P()});function b(){const s=c.geoDataNew.map(a=>{const o=new O(S([a.lon,a.lat])),g=new I(o);return g.setProperties({codigo:a.codigo,nombre_comun:a.nombre_comun,nombre_cientifico:a.nombre_cientifico,numero_placa:a.numero_placa,coordenadas:a.coordenadas,departamento:a.departamento,municipio:a.municipio,vereda:a.vereda,nombre_del_predio:a.nombre_del_predio,resultado:a.resultado}),g});_.clear(),_.addFeatures(s)}function P(){if(c.geoDataNew.length>0){t&&(t.setTarget(null),t=null),b(),c.calculatePerimeterCoordinates();const s=c.coordinatesPolygon;k(s,_)}}let C=8.4;function k(s,a){const o=[-75.5277,1.1961],g=[o[0]-.3,o[1]];t=new re({target:w.value,layers:[new ie({source:new le({opacity:.8})})],view:new de({center:S(g),zoom:C,minZoom:7.15,maxZoom:30})}),t.getViewport().style.cursor="pointer";const x=new _e({src:ue,scale:.4,anchor:[.5,1]}),W=new pe({source:a,style:new E({image:x})}),H=s.map(F=>S(F)),J=new K([H]),Z=new I({geometry:J});Z.setStyle(new E({stroke:new U({color:"green",width:2}),fill:new z({color:"rgba(0, 255, 0, 0.1)"})})),a.addFeature(Z),t.addLayer(W),t.on("pointermove",F=>{t.getView().setZoom(t.getView().getZoom());const Q=t.getEventPixel(F.originalEvent),G=t.forEachFeatureAtPixel(Q,X=>X);G&&G.getGeometry()instanceof O?(t.getViewport().style.cursor="pointer",n.value=G,d.value&&(d.value.style.display="block")):(t.getViewport().style.cursor="",d.value&&(d.value.style.display="none"))}),window.addEventListener("resize",T);function T(){t&&t.getView()&&(window.innerWidth<768?t.getView().setZoom(5.5):t.getView().setZoom(C))}T()}return(s,a)=>{const o=B("font-awesome-icon");return u(),p($,null,[e("div",{class:"map-container",ref_key:"mapContainer",ref:w},null,512),e("div",{class:"info__map",ref_key:"infoContainer",ref:d},[n.value?(u(),p("div",me,[e("p",fe,[r(o,{icon:["fas","fingerprint"]}),i(" Código especie: "),e("span",ve,l(n.value.getProperties().codigo),1)]),e("p",ge,[r(o,{icon:["fab","glide"]}),i(" Nombre común: "),e("span",he,l(n.value.getProperties().nombre_comun),1)]),e("p",we,[r(o,{icon:["fas","signature"]}),i(" Nombre científico: "),e("span",ye,l(n.value.getProperties().nombre_cientifico),1)]),e("p",be,[r(o,{icon:["fas","hashtag"]}),i(" Número de placa: "),e("span",Pe,l(n.value.getProperties().numero_placa),1)]),e("p",Ce,[r(o,{icon:["fas","location-crosshairs"]}),i(" Coordenadas: "),e("span",Ve,l(n.value.getProperties().coordenadas),1)]),e("p",Se,[r(o,{icon:["fab","squarespace"]}),i(" Departamento: "),e("span",$e,l(n.value.getProperties().departamento),1)]),e("p",Me,[r(o,{icon:["fab","squarespace"]}),i(" Municipio: "),e("span",ke,l(n.value.getProperties().municipio),1)]),e("p",xe,[r(o,{icon:["fab","squarespace"]}),i(" Vereda: "),e("span",Fe,l(n.value.getProperties().vereda),1)]),e("p",Ge,[r(o,{icon:["fas","location-dot"]}),i(" Nombre del predio: "),e("span",Ne,l(n.value.getProperties().nombre_del_predio),1)]),e("p",De,[r(o,{icon:["fas","star"]}),i(" Puntaje evaluación: "),e("span",Le,l(n.value.getProperties().resultado),1)])])):j("",!0)],512)],64)}}},Ee=ee("locatesColombia",()=>{const f=m([]),v=m({});return R(async()=>{try{const w=(await q.getDepartments()).data.filter(n=>n.name==="Putumayo"||n.name==="Caquetá");f.value=w;const d=await q.getCities();v.value=d.data}catch(c){console.error("Error al obtener datos: ",c)}}),{departments:f,cities:v}});const h=f=>(ae("data-v-349777cc"),f=f(),ne(),f),Re={class:"contenedor"},Ze=h(()=>e("h1",{class:"reporte__heading"}," Mapa general de especies forestales ",-1)),Te=h(()=>e("hr",null,null,-1)),qe={class:"mapa__grid"},Oe={class:"mapaOpciones"},Ke={class:"menu"},Ue=h(()=>e("legend",{class:"menu__titulo"},"Filtrar",-1)),ze=h(()=>e("option",{value:{code:"",name:""},disabled:""}," Seleccione un departamento... ",-1)),Ae=["value"],Be={key:0},je=h(()=>e("option",{value:"",disabled:"",selected:""}," Seleccione un municipio... ",-1)),We=["value"],He=h(()=>e("option",{value:"",selected:"",disabled:""}," Seleccione una especie... ",-1)),Je=["value"],Qe={class:"menu__botones"},Xe={class:"menu"},Ye=h(()=>e("legend",{class:"menu__titulo"},"Opciones",-1)),eo={class:"menu__botones"},oo={class:"mapa"},to={__name:"MapGeneralView",setup(f){const v=Ee(),c=A(),w=te(),d=m(null),n=m(""),t=m({code:"",name:""}),_=m("");R(async()=>{await c.fetchData()});function M(){d.value&&d.value.onlyPerimeter&&d.value.onlyPerimeter()}const y=()=>{c.filterGeo(t.value.name,_.value,n.value),c.calculatePerimeterCoordinates(t.value.name,_.value,n.value)},b=se(()=>t.value.code?v.cities.filter(s=>s.department_id===t.value.code):[]);function P(){n.value="",t.value={code:"",name:""},_.value=""}function C(){P(),c.deleteFilterGeo()}return(k,s)=>{const a=B("font-awesome-icon");return u(),p("div",Re,[Ze,Te,e("div",qe,[e("div",Oe,[e("fieldset",Ke,[Ue,N(e("select",{class:"filtro__select",id:"department","onUpdate:modelValue":s[0]||(s[0]=o=>t.value=o),onChange:y},[ze,(u(!0),p($,null,L(V(v).departments,o=>(u(),p("option",{key:o.id,value:{code:o.code,name:o.name}},l(o.name),9,Ae))),128))],544),[[D,t.value]]),b.value.length>0?(u(),p("div",Be,[N(e("select",{class:"filtro__select",id:"city","onUpdate:modelValue":s[1]||(s[1]=o=>_.value=o),onChange:y},[je,(u(!0),p($,null,L(b.value,o=>(u(),p("option",{key:o.id,value:o.name},l(o.name),9,We))),128))],544),[[D,_.value]])])):j("",!0),N(e("select",{id:"especie",class:"filtro__select",onChange:y,"onUpdate:modelValue":s[2]||(s[2]=o=>n.value=o)},[He,(u(!0),p($,null,L(V(w).uniqueNomComunes,o=>(u(),p("option",{key:o.cod_especie,value:o.cod_especie},l(o.nom_comunes+" | "+o.nombre_cientifico),9,Je))),128))],544),[[D,n.value]]),e("div",Qe,[e("button",{type:"submit",class:"filtro__boton",onClick:C},[r(a,{icon:["fas","filter-circle-xmark"],class:"mr-2"}),i(" Eliminar filtro ")])])]),e("fieldset",Xe,[Ye,e("div",eo,[e("button",{type:"submit",class:"menu__boton",onClick:s[3]||(s[3]=o=>V(c).exportToKML(V(c).coordinatesKML))},[r(a,{icon:["fas","arrows-to-eye"],class:"mr-2"}),i(" Exportar KML/KMZ ")]),e("button",{type:"submit",class:"menu__boton",onClick:M},[r(a,{icon:["fas","draw-polygon"],class:"mr-2"}),i(" Ver Perímetro ")])])])]),e("div",oo,[r(Ie,{ref_key:"renderGeoMapRef",ref:d},null,512)])])])}}},no=oe(to,[["__scopeId","data-v-349777cc"]]);export{no as default};
